# 第3节 Nginx

## 网络请求路径

（客户端输入URL定位符）→（DNS服务器寻找映射）→（进入服务器，处理数据）→（返回数据至客户端）



## DNS

DNS是客户端发送请求中一个非常重要的中转，他的作用是将用户请求的URL映射为具体的IP地址，全世界有13台根服务器，但通常为我们进行域名解析的并不是根服务器，而是直接访问我们的 LDNS（Local DNS Server），通常由网络运营商维护。



最早的负载均衡就是利用搭建本地DNS服务器实现的，实现方式简单易懂，为同一个主机名分配多个映射 ，可采用轮循，随机等方式分配请求。看上去没什么问题，但是在使用过程中会发现，如果其中一个地址down机，我们是无法及时发现的，如果有用户被分配到这个主机就会出现访问失败的状况，同时我们也无法判断每个server的负载，可能会出现，某个server几乎闲置，另外一个server负载压力极高的情况。

![img](./static/5e4d414cgw1er7cs8cplij20ji02fglw.jpg.jpeg) 



## 硬件设备

负载均衡器（Load Balancer），负载均衡器通常作为独立的硬件置于客户端与服务器之间。

负载均衡设备拥有非常好的负载均衡性能，他拥有众多的负载均衡策略（权重，动态比率，最快模式，最小连接数等），可以保证以相对较优的方式分配请求，不过好的东西总是有代价的，那就是价格，一台负载均衡器的售价往往高达十几万甚至几十万，许多企业并不愿意为它买单。



## 反向代理

Nginx。高性能，轻量级，已经成了人们对Nginx的第一印象，Nginx可作为HTTP服务器，在处理高并发请求的时候拥有比现在主流的Apache服务器更高的性能，同时Nginx也是一个优秀的反向代理服务器。



反向代理在服务器端，无需主动链接，当我们访问拥有反向代理的网站时，实际访问的是其反向代理服务器，而非真正的服务器，当请求到达反向代理服务器时，反向代理服务器再将请求转发至服务器。反向代理是实现负载均衡的主流手段之一，通常使用Nginx等服务器搭建，Nginx同样拥有众多的分配策略，以保证平均分配压力

![img](./static/5e4d414cgw1er7cs8rp0xj20k002jaad.jpg.jpeg)



## CDN

**内容分发网络（Content Delivery Network），简称：CDN**。

CDN简单的来说就是存储一些静态文件的一台或多台服务器，通过复制，缓存等方式，将文件保存其中。



1.哪些是静态文件？

css，html，图片，媒体都属于静态文件，也就是说用户发送的请求不会影响静态文件的内容，而jsp，php等文件就不属于静态文件，因为他们的内容会因我们的请求而发生改变。

2.CDN如何实现加速？

通常情况下，我们所要的数据都是从主服务器中获取，但假如我们的主服务器在南方，而访问用户在北方，那么访问速度就会相对变慢，变慢的原因有很多，例如传输距离，运营商，带宽等等因素，而使用CDN技术的话，我们会将CDN节点分布在各地，当用户发送请求到达服务器时，服务器会根据用户的区域信息，为用户分配最近的CDN服务器。

3.CDN数据从哪里来？

**复制，缓存**，CDN服务器可以在用户请求后缓存文件，也可以主动抓取主服务器内容。



--------------------------------------------------------------------------------------------------------------------------



应用

1．[DNS负载均衡](http://baike.baidu.com/view/486963.htm)最早的[负载均衡技术](http://baike.baidu.com/view/1234431.htm)是通过DNS来实现的，在DNS中为多个地址配置同一个名字，因而查询这个名字的客户机将得到其中一个地址，从而使得不同的客户访问不同的[服务器](http://baike.baidu.com/view/899.htm)，达到负载均衡的目的。DNS负载均衡是一种简单而有效的方法，但是它不能区分[服务器](http://baike.baidu.com/view/899.htm)的差异，也不能反映服务器的当前运行状态。

2．[代理服务器](http://baike.baidu.com/view/751.htm)负载均衡 使用代理服务器，可以将请求转发给内部的服务器，使用这种加速模式显然可以提升静态网页的访问速度。然而，也可以考虑这样一种技术，使用[代理服务器](http://baike.baidu.com/view/751.htm)将请求均匀转发给多台服务器，从而达到负载均衡的目的。

3．[地址转换网关](http://baike.baidu.com/view/3750570.htm)负载均衡 支持负载均衡的地址转换网关，可以将一个外部IP地址映射为多个内部IP地址，对每次TCP连接请求动态使用其中一个内部地址，达到负载均衡的目的。

4．[协议内部支持负载均衡](http://baike.baidu.com/view/486961.htm)除了这三种负载均衡方式之外，有的协议内部支持与负载均衡相关的功能，例如[HTTP协议](http://baike.baidu.com/view/70545.htm)中的重定向能力等，HTTP运行于TCP连接的最高层。

5．[NAT负载均衡](http://baike.baidu.com/view/486964.htm)NAT（Network Address Translation[网络地址转换](http://baike.baidu.com/view/875777.htm)）简单地说就是将一个IP地址转换为另一个IP地址，一般用于未经注册的内部地址与合法的、已获注册的Internet IP地址间进行转换。适用于解决Internet IP地址紧张、不想让网络外部知道内部网络结构等的场合下。

6．[反向代理负载均衡](http://baike.baidu.com/view/486965.htm)普通代理方式是代理内部网络用户访问internet上[服务器](http://baike.baidu.com/view/899.htm)的连接请求，[客户端](http://baike.baidu.com/view/930.htm)必须指定[代理服务器](http://baike.baidu.com/view/751.htm)，并将本来要直接发送到internet上服务器的连接请求发送给代理服务器处理。反向代理（Reverse Proxy）方式是指以[代理服务器](http://baike.baidu.com/view/751.htm)来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。反向代理负载均衡技术是把将来自internet上的连接请求以反向代理的方式动态地转发给内部网络上的多台服务器进行处理，从而达到负载均衡的目的。

7．[混合型负载均衡](http://baike.baidu.com/view/486966.htm)在有些大型网络，由于多个[服务器](http://baike.baidu.com/view/899.htm)群内硬件设备、各自的规模、提供的服务等的差异，可以考虑给每个服务器群采用最合适的负载均衡方式，然后又在这多个服务器群间再一次负载均衡或群集起来以一个整体向外界提供服务（即把这多个服务器群当做一个新的服务器群），从而达到最佳的性能。将这种方式称之为[混合型负载均衡](http://baike.baidu.com/view/486966.htm)。此种方式有时也用于单台均衡设备的性能不能满足大量连接请求的情况下。